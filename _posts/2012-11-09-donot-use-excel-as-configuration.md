---
title: 为何不要用Excel文件作为配置文件
---

约一个月前左右，连续听到两个用Excel作配置文件的案例。第一次我的反应是很惊奇地问为什么？我之所以惊奇，是没这样做过，甚至没听说过。第二次听到后，我开始想为什么不呢。是不是我们从不这样做，所以就不能呢？用Excel文件作配置，到底有什么好处和坏处呢？可经过考虑后，我的答案依然是不要。

1. 首先我想到的是烦人的Excel.exe进程。大多操作Excel使用的是微软提供的automation（也可以说OLE, COM或者ActiveX等等），这些技术都会启动一个Excel.exe进程来操作Excel文件。可惜这个进程不大听话，抛出的错误基本又无参考价值，相信很多同学直到今天也能体会。有时面对用户反馈出的莫名其妙错误，第一解决方法就是关闭Excel程序，并kill掉所有后台的Excel.exe进程，再试一遍。然后就Okay了。有时这个进程老是不退出，即时你在代码中明确写了ExcleApp.Exit。然后你在开发调试过程中，你可能就会发现n个Excel.exe在你的任务管理器中，你不得不一个一个地kill掉。这可能是老黄历了，只不过曾经的阴影，让我条件反射地第一个就想起这个因素。虽然可能随着技术地发展，Excel.exe变得可靠多了。但毕竟是跨进程操作，不稳定因素要多些。
2. 第三方组件的依赖。无论使用微软的组件，还是其他方提供的存在不兼容地风险的组件，那么你的程序都得增加这些组件的依赖。那么意味着我们得管理版本和部署。想想如果我们用的是Excel 2007，而运行环境却只有Excel 2003；或者你完全有信心那些非MS组件能在各种Windows上都表现得很好？再想想，客户把配置文件发给你处理紧急情况，你却可能不得不先去装一个OfficeSad smile。
3. 使用第三方组件，增加了学习曲线。毕竟相对常用的配置方式，并不是每个人都掌握了这些组件。为什么不用一个常用方法，来减轻大家的工作量呢？
4. 从使用来说，Excel是二维电子表格。我猜大多就是使用键值对来存储配置。一列为关键字，一列为值。那么对于那些有层次结构的异构配置呢？比如有多个用户，每个用户下还有多个权限的配置。用户有3个属性，而权限有5个，如何在Excel中表现？即使用键值对表示出来了，那么如何快速地定位和查找呢？

那么使用Excel的原因呢？数据编辑方便！但这还不足以成为选择Excel文件作为配置文件的原因。一般来说配置项不会太多，使用一个文本编辑器足以搞定。而掌握一个好的文本编辑器也是写代码的基本要求。如果有很多数据（不要把数据和配置混在一起）。那么我也建议使用Excel编辑后，转换为其他文本格式，如csv。

现在的配置常用方法是XML，或者YAML（一种简洁的使用类似JSON数据的表示方法）。如果你说还有ini的话，那么说明你也老了:)这些方法都是文本的，几乎就是为配置而生的，而各编程语言都内置了很好的支持(YAML较新，但相信很快就会成标配）。

或许会觉得我有点吹毛求疵了。在这些案例中，对配置要求很简单，而我说的一些情况是小概率。那么我真正想说的是：

1. 没人能保证当前的要求不会变复杂。也不要相信当需要的时候再改的鬼话。拖的越久更改的可能性越小，直到不得不改的时候，那已经走了很多冤枉路了。
2. 预防胜过治疗。为什么不减少问题引入的风险，而是怀着侥幸心理以为问题不会发生呢？所谓能干的人解决问题，而聪明的人回避问题。

再结合成本考虑，Excel文件做配置并没带来多大的好处，那为什么我们不一开始就走在正确的道路上呢？